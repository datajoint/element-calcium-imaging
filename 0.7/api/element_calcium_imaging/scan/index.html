
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="http://localhost/docs/elements/element-calcium-imaging/0.7/api/element_calcium_imaging/scan/">
      
      
        <link rel="prev" href="../plotting/widget/">
      
      
        <link rel="next" href="../../../changelog/">
      
      <link rel="icon" href="../../../assets/images/company-logo-blue.png">
      <meta name="generator" content="mkdocs-1.4.3, mkdocs-material-9.1.15">
    
    
      
        <title>scan.py - DataJoint Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.26e3688c.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.ecc896b0.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto+Slab:300,300i,400,400i,700,700i%7CSource+Code+Pro:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto Slab";--md-code-font:"Source Code Pro"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../../assets/stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="datajoint" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#element_calcium_imaging.scan" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="DataJoint Documentation" class="md-header__button md-logo" aria-label="DataJoint Documentation" data-md-component="logo">
      
  
  <?xml version="1.0" encoding="utf-8"?>
<!-- Generator: Adobe Illustrator 15.1.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 width="260.479px" height="365.463px" viewBox="0 0 260.479 365.463" enable-background="new 0 0 260.479 365.463"
	 xml:space="preserve">
<g>
	<path d="M4.638,361.434c0,0,124.071-124.072,135.896-357.434c0,0,29.555,189.053,115.266,256.988
		C255.799,260.988,173.038,249.174,4.638,361.434z"/>
</g>
</svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            DataJoint Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              scan.py
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
          
            
            
            
            <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="datajoint" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
            
              <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
              </label>
            
          
            
            
            
            <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
            
              <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
              </label>
            
          
        </form>
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/datajoint/element-calcium-imaging" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    datajoint/element-calcium-imaging
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    




<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="" data-md-level="0">
    <label class="md-nav__title" for="__drawer">
        <a href="../../.." title="DataJoint Documentation"
            class="md-nav__button md-logo" aria-label="DataJoint Documentation" data-md-component="logo">
            
  
  <?xml version="1.0" encoding="utf-8"?>
<!-- Generator: Adobe Illustrator 15.1.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 width="260.479px" height="365.463px" viewBox="0 0 260.479 365.463" enable-background="new 0 0 260.479 365.463"
	 xml:space="preserve">
<g>
	<path d="M4.638,361.434c0,0,124.071-124.072,135.896-357.434c0,0,29.555,189.053,115.266,256.988
		C255.799,260.988,173.038,249.174,4.638,361.434z"/>
</g>
</svg>

        </a><a href="https://datajoint.com/docs/elements/" title="DataJoint Elements">
            ⬅ Home
        </a>
    </label>
    
    <div class="md-nav__source">
        <a href="https://github.com/datajoint/element-calcium-imaging" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    datajoint/element-calcium-imaging
  </div>
</a>
    </div>
    
    <ul class="md-nav__list" data-md-scrollfix>
        
        
        
        

  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        Element Calcium Imaging
      </a>
    </li>
  

        
        
        
        

  
  
  
    <li class="md-nav__item">
      <a href="../../../pipeline/" class="md-nav__link">
        Data Pipeline
      </a>
    </li>
  

        
        
        
        

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
      
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../../tutorials/">Tutorials</a>
          
            <label for="__nav_3">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Tutorials
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../tutorials/tutorial.ipynb" class="md-nav__link">
        Tutorial Notebook
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../tutorials/quality_metrics.ipynb" class="md-nav__link">
        Quality Metrics Notebook
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

        
        
        
        

  
  
  
    <li class="md-nav__item">
      <a href="../../../concepts/" class="md-nav__link">
        Concepts
      </a>
    </li>
  

        
        
        
        

  
  
  
    <li class="md-nav__item">
      <a href="../../../partnerships/" class="md-nav__link">
        Key Partnerships
      </a>
    </li>
  

        
        
        
        

  
  
  
    <li class="md-nav__item">
      <a href="../../../roadmap/" class="md-nav__link">
        Roadmap
      </a>
    </li>
  

        
        
        
        

  
  
  
    <li class="md-nav__item">
      <a href="../../../citation/" class="md-nav__link">
        Citation
      </a>
    </li>
  

        
        
        
        

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" checked>
      
      
      
        <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
          API
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          API
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_1" checked>
      
      
      
        <label class="md-nav__link" for="__nav_8_1" id="__nav_8_1_label" tabindex="0">
          element_calcium_imaging
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_1_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_8_1">
          <span class="md-nav__icon md-icon"></span>
          element_calcium_imaging
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../analysis/" class="md-nav__link">
        analysis.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../imaging/" class="md-nav__link">
        imaging.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../imaging_no_curation/" class="md-nav__link">
        imaging_no_curation.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../imaging_preprocess/" class="md-nav__link">
        imaging_preprocess.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../imaging_report/" class="md-nav__link">
        imaging_report.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_1_6" >
      
      
      
        <label class="md-nav__link" for="__nav_8_1_6" id="__nav_8_1_6_label" tabindex="0">
          plotting
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_8_1_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_8_1_6">
          <span class="md-nav__icon md-icon"></span>
          plotting
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../plotting/cell_plot/" class="md-nav__link">
        cell_plot.py
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../plotting/widget/" class="md-nav__link">
        widget.py
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          scan.py
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        scan.py
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#element_calcium_imaging.scan" class="md-nav__link">
    element_calcium_imaging.scan
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#element_calcium_imaging.scan.activate" class="md-nav__link">
    activate()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#element_calcium_imaging.scan.get_imaging_root_data_dir" class="md-nav__link">
    get_imaging_root_data_dir()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#element_calcium_imaging.scan.get_processed_root_data_dir" class="md-nav__link">
    get_processed_root_data_dir()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#element_calcium_imaging.scan.get_image_files" class="md-nav__link">
    get_image_files()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#element_calcium_imaging.scan.AcquisitionSoftware" class="md-nav__link">
    AcquisitionSoftware
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#element_calcium_imaging.scan.Channel" class="md-nav__link">
    Channel
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#element_calcium_imaging.scan.Scan" class="md-nav__link">
    Scan
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#element_calcium_imaging.scan.ScanLocation" class="md-nav__link">
    ScanLocation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#element_calcium_imaging.scan.ScanInfo" class="md-nav__link">
    ScanInfo
  </a>
  
    <nav class="md-nav" aria-label="ScanInfo">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#element_calcium_imaging.scan.ScanInfo.Field" class="md-nav__link">
    Field
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#element_calcium_imaging.scan.ScanInfo.ScanFile" class="md-nav__link">
    ScanFile
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#element_calcium_imaging.scan.ScanInfo.make" class="md-nav__link">
    make()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#element_calcium_imaging.scan.ScanQualityMetrics" class="md-nav__link">
    ScanQualityMetrics
  </a>
  
    <nav class="md-nav" aria-label="ScanQualityMetrics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#element_calcium_imaging.scan.ScanQualityMetrics.Frames" class="md-nav__link">
    Frames
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

        
        
        
        

  
  
  
    <li class="md-nav__item">
      <a href="../../../changelog/" class="md-nav__link">
        Changelog
      </a>
    </li>
  

        
    </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  <h1>scan.py</h1>

<div class="doc doc-object doc-module">


<a id="element_calcium_imaging.scan"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">







<div class="doc doc-object doc-function">



<h2 id="element_calcium_imaging.scan.activate" class="doc doc-heading">
<code class="highlight language-python"><span class="n">activate</span><span class="p">(</span><span class="n">scan_schema_name</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">create_schema</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">create_tables</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">linking_module</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#element_calcium_imaging.scan.activate" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Activate this schema.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>scan_schema_name</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Schema name on the database server to activate the
<code>scan</code> module</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>create_schema</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>When True (default), create schema in the database if it
does not yet exist.</p>
            </div>
          </td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>create_tables</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>When True (default), create tables in the database if they
do not yet exist.</p>
            </div>
          </td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>linking_module</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A module name or a module containing the required
dependencies to activate the <code>scan</code> module.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>
      <p>Dependencies:</p>

<details class="upstream-tables" open>
  <summary>Upstream tables</summary>
  <ul>
<li>Session: Parent table to Scan, typically identifying a recording session</li>
<li>Equipment: Reference table for Scan, specifying the equipment used for the
    acquisition of this scan.</li>
<li>Location: Reference table for ScanLocation, specifying the scanned regions's
    anatomical location in the brain.</li>
</ul>
</details>
      <details class="quote">
        <summary>Source code in <code>element_calcium_imaging/scan.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">activate</span><span class="p">(</span>
    <span class="n">scan_schema_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">create_schema</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">create_tables</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">linking_module</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Activate this schema.</span>

<span class="sd">    Args:</span>
<span class="sd">        scan_schema_name (str): Schema name on the database server to activate the</span>
<span class="sd">            `scan` module</span>
<span class="sd">        create_schema (bool): When True (default), create schema in the database if it</span>
<span class="sd">            does not yet exist.</span>
<span class="sd">        create_tables (bool): When True (default), create tables in the database if they</span>
<span class="sd">            do not yet exist.</span>
<span class="sd">        linking_module (str): A module name or a module containing the required</span>
<span class="sd">            dependencies to activate the `scan` module.</span>

<span class="sd">    Dependencies:</span>
<span class="sd">    Upstream tables:</span>
<span class="sd">        + Session: Parent table to Scan, typically identifying a recording session</span>
<span class="sd">        + Equipment: Reference table for Scan, specifying the equipment used for the</span>
<span class="sd">            acquisition of this scan.</span>
<span class="sd">        + Location: Reference table for ScanLocation, specifying the scanned regions&#39;s</span>
<span class="sd">            anatomical location in the brain.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">linking_module</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">linking_module</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span><span class="n">linking_module</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">inspect</span><span class="o">.</span><span class="n">ismodule</span><span class="p">(</span>
        <span class="n">linking_module</span>
    <span class="p">),</span> <span class="s2">&quot;The argument &#39;dependency&#39; must be a module&#39;s name or a module&quot;</span>

    <span class="k">global</span> <span class="n">_linking_module</span>
    <span class="n">_linking_module</span> <span class="o">=</span> <span class="n">linking_module</span>

    <span class="n">schema</span><span class="o">.</span><span class="n">activate</span><span class="p">(</span>
        <span class="n">scan_schema_name</span><span class="p">,</span>
        <span class="n">create_schema</span><span class="o">=</span><span class="n">create_schema</span><span class="p">,</span>
        <span class="n">create_tables</span><span class="o">=</span><span class="n">create_tables</span><span class="p">,</span>
        <span class="n">add_objects</span><span class="o">=</span><span class="n">_linking_module</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>






<div class="doc doc-object doc-function">



<h2 id="element_calcium_imaging.scan.get_imaging_root_data_dir" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_imaging_root_data_dir</span><span class="p">()</span></code>

<a href="#element_calcium_imaging.scan.get_imaging_root_data_dir" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Return imaging root data director(y/ies)</p>
<p>Retrieve the root data director(y/ies) containing the imaging data
for all subjects/sessions (e.g. acquired ScanImage raw files, output files from
processing routines, etc.). All data paths and directories in DataJoint Elements are
recommended to be stored as relative paths (posix format), with respect to some
user-configured "root" directory, which varies from machine to machine
(e.g. different mounted drive locations).</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>dirs</code></td>          <td>
                <code>list</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A list of string(s) or Path(s) for the absolute paths of the imaging root data
director(y/ies).</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>element_calcium_imaging/scan.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_imaging_root_data_dir</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Return imaging root data director(y/ies)</span>

<span class="sd">    Retrieve the root data director(y/ies) containing the imaging data</span>
<span class="sd">    for all subjects/sessions (e.g. acquired ScanImage raw files, output files from</span>
<span class="sd">    processing routines, etc.). All data paths and directories in DataJoint Elements are</span>
<span class="sd">    recommended to be stored as relative paths (posix format), with respect to some</span>
<span class="sd">    user-configured &quot;root&quot; directory, which varies from machine to machine</span>
<span class="sd">    (e.g. different mounted drive locations).</span>

<span class="sd">    Returns:</span>
<span class="sd">        dirs (list): A list of string(s) or Path(s) for the absolute paths of the imaging root data</span>
<span class="sd">            director(y/ies).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">root_directories</span> <span class="o">=</span> <span class="n">_linking_module</span><span class="o">.</span><span class="n">get_imaging_root_data_dir</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">root_directories</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">)):</span>
        <span class="n">root_directories</span> <span class="o">=</span> <span class="p">[</span><span class="n">root_directories</span><span class="p">]</span>

    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">_linking_module</span><span class="p">,</span> <span class="s2">&quot;get_processed_root_data_dir&quot;</span><span class="p">):</span>
        <span class="n">root_directories</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_linking_module</span><span class="o">.</span><span class="n">get_processed_root_data_dir</span><span class="p">())</span>

    <span class="k">return</span> <span class="n">root_directories</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>






<div class="doc doc-object doc-function">



<h2 id="element_calcium_imaging.scan.get_processed_root_data_dir" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_processed_root_data_dir</span><span class="p">()</span></code>

<a href="#element_calcium_imaging.scan.get_processed_root_data_dir" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Retrieve the root directory for all processed data.</p>
<p>All data paths and directories in DataJoint Elements are recommended to be stored as
relative paths (posix format), with respect to some user-configured "root"
directory, which varies from machine to machine (e.g. different mounted drive
locations).</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>dir</code></td>          <td>
                <code>str | pathlib.<span title="pathlib.Path">Path</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Absolute path of the processed imaging root data
directory.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>element_calcium_imaging/scan.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_processed_root_data_dir</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Retrieve the root directory for all processed data.</span>

<span class="sd">    All data paths and directories in DataJoint Elements are recommended to be stored as</span>
<span class="sd">    relative paths (posix format), with respect to some user-configured &quot;root&quot;</span>
<span class="sd">    directory, which varies from machine to machine (e.g. different mounted drive</span>
<span class="sd">    locations).</span>

<span class="sd">    Returns:</span>
<span class="sd">        dir (str| pathlib.Path): Absolute path of the processed imaging root data</span>
<span class="sd">            directory.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">_linking_module</span><span class="p">,</span> <span class="s2">&quot;get_processed_root_data_dir&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_linking_module</span><span class="o">.</span><span class="n">get_processed_root_data_dir</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">get_imaging_root_data_dir</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>






<div class="doc doc-object doc-function">



<h2 id="element_calcium_imaging.scan.get_image_files" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_image_files</span><span class="p">(</span><span class="n">scan_key</span><span class="p">,</span> <span class="n">file_type</span><span class="p">)</span></code>

<a href="#element_calcium_imaging.scan.get_image_files" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Retrieve the list of image files associated with a given Scan.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>scan_key</code></td>
          <td>
                <code>dict</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Primary key of a Scan entry.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>list</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A list of full file paths.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>element_calcium_imaging/scan.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_image_files</span><span class="p">(</span><span class="n">scan_key</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">file_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Retrieve the list of image files associated with a given Scan.</span>

<span class="sd">    Args:</span>
<span class="sd">        scan_key: Primary key of a Scan entry.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A list of full file paths.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_linking_module</span><span class="o">.</span><span class="n">get_image_files</span><span class="p">(</span><span class="n">scan_key</span><span class="p">,</span> <span class="n">file_type</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>






<div class="doc doc-object doc-class">



<h2 id="element_calcium_imaging.scan.AcquisitionSoftware" class="doc doc-heading">
        <code>AcquisitionSoftware</code>


<a href="#element_calcium_imaging.scan.AcquisitionSoftware" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="datajoint">dj</span>.<span title="datajoint.Lookup">Lookup</span></code></p>

  
      <p>A list of acquisition softwares supported by the Element.</p>
<p>Required to define a scan.</p>

  <p><strong>Attributes:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>acq_software</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Acquisition software</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>


        <details class="quote">
          <summary>Source code in <code>element_calcium_imaging/scan.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@schema</span>
<span class="k">class</span> <span class="nc">AcquisitionSoftware</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">Lookup</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A list of acquisition softwares supported by the Element.</span>

<span class="sd">    Required to define a scan.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        acq_software (str): Acquisition software</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;  # Acquisition softwares</span>
<span class="s2">    acq_software: varchar(24)</span>
<span class="s2">    &quot;&quot;&quot;</span>
    <span class="n">contents</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">([</span><span class="s2">&quot;ScanImage&quot;</span><span class="p">,</span> <span class="s2">&quot;Scanbox&quot;</span><span class="p">,</span> <span class="s2">&quot;NIS&quot;</span><span class="p">,</span> <span class="s2">&quot;PrairieView&quot;</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">





  </div>

  </div>

</div>






<div class="doc doc-object doc-class">



<h2 id="element_calcium_imaging.scan.Channel" class="doc doc-heading">
        <code>Channel</code>


<a href="#element_calcium_imaging.scan.Channel" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="datajoint">dj</span>.<span title="datajoint.Lookup">Lookup</span></code></p>

  
      <p>Recording channels for the imaging wavelengths.</p>

  <p><strong>Attributes:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>channel</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Channel index</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>


        <details class="quote">
          <summary>Source code in <code>element_calcium_imaging/scan.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@schema</span>
<span class="k">class</span> <span class="nc">Channel</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">Lookup</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Recording channels for the imaging wavelengths.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        channel (int): Channel index</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;  # A recording channel</span>
<span class="s2">    channel     : tinyint  # 0-based indexing</span>
<span class="s2">    &quot;&quot;&quot;</span>
    <span class="n">contents</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">





  </div>

  </div>

</div>






<div class="doc doc-object doc-class">



<h2 id="element_calcium_imaging.scan.Scan" class="doc doc-heading">
        <code>Scan</code>


<a href="#element_calcium_imaging.scan.Scan" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="datajoint">dj</span>.<span title="datajoint.Manual">Manual</span></code></p>

  
      <p>Scan defined by a measurement done using a scanner and an acquisition software.</p>
<p>The details of the scanning data is placed in other tables, including,
ScanLocation, ScanInfo, and ScanInfo's part tables.</p>

  <p><strong>Attributes:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>Session</code></td>
          <td>
                <code>foreign key</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A primary key from Session.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>scan_id</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Unique Scan ID.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>Equipment</code></td>
          <td>
                <code>foreign key</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A primary key from Equipment.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>AcquisitionSoftware</code></td>
          <td>
                <code>foreign key</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A primary key from AcquisitionSoftware.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>scan_notes</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Notes of the experimenter regarding the scan.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>


        <details class="quote">
          <summary>Source code in <code>element_calcium_imaging/scan.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@schema</span>
<span class="k">class</span> <span class="nc">Scan</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">Manual</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Scan defined by a measurement done using a scanner and an acquisition software.</span>

<span class="sd">    The details of the scanning data is placed in other tables, including,</span>
<span class="sd">    ScanLocation, ScanInfo, and ScanInfo&#39;s part tables.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        Session (foreign key): A primary key from Session.</span>
<span class="sd">        scan_id (int): Unique Scan ID.</span>
<span class="sd">        Equipment (foreign key, optional): A primary key from Equipment.</span>
<span class="sd">        AcquisitionSoftware (foreign key): A primary key from AcquisitionSoftware.</span>
<span class="sd">        scan_notes (str, optional): Notes of the experimenter regarding the scan.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    -&gt; Session</span>
<span class="s2">    scan_id: int</span>
<span class="s2">    ---</span>
<span class="s2">    -&gt; [nullable] Equipment</span>
<span class="s2">    -&gt; AcquisitionSoftware</span>
<span class="s2">    scan_notes=&#39;&#39; : varchar(4095)</span>
<span class="s2">    &quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">





  </div>

  </div>

</div>






<div class="doc doc-object doc-class">



<h2 id="element_calcium_imaging.scan.ScanLocation" class="doc doc-heading">
        <code>ScanLocation</code>


<a href="#element_calcium_imaging.scan.ScanLocation" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="datajoint">dj</span>.<span title="datajoint.Manual">Manual</span></code></p>

  
      <p>Anatomical location of the scanned region in the brain</p>

  <p><strong>Attributes:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>Scan</code></td>
          <td>
                <code>foreign key</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A primary key from Scan.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>Locaton</code></td>
          <td>
                <code>foreign key</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A primary key from Location.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>


        <details class="quote">
          <summary>Source code in <code>element_calcium_imaging/scan.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@schema</span>
<span class="k">class</span> <span class="nc">ScanLocation</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">Manual</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Anatomical location of the scanned region in the brain</span>

<span class="sd">    Attributes:</span>
<span class="sd">        Scan (foreign key): A primary key from Scan.</span>
<span class="sd">        Locaton (foreign key): A primary key from Location.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot; # Anatomical location</span>
<span class="s2">    -&gt; Scan</span>
<span class="s2">    ---</span>
<span class="s2">    -&gt; Location</span>
<span class="s2">    &quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">





  </div>

  </div>

</div>






<div class="doc doc-object doc-class">



<h2 id="element_calcium_imaging.scan.ScanInfo" class="doc doc-heading">
        <code>ScanInfo</code>


<a href="#element_calcium_imaging.scan.ScanInfo" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="datajoint">dj</span>.<span title="datajoint.Imported">Imported</span></code></p>

  
      <p>Information about the scan extracted from the recorded files.</p>

  <p><strong>Attributes:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>Scan</code></td>
          <td>
                <code>foreign key</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A primary key from Scan.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>nfields</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Number of fields.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>nchannels</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Number of channels.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>ndepths</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Number of scanning depths (planes).</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>nframes</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Number of recorded frames.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>nrois</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Number of ROIs (see scanimage's multi ROI imaging).</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>x</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>ScanImage's 0 point in the motor coordinate system (um).</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>y</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>ScanImage's 0 point in the motor coordinate system (um).</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>z</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>ScanImage's 0 point in the motor coordinate system (um).</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>fps</code></td>
          <td>
                <code>float) </code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Frames per second (Hz) - Volumetric Scan Rate.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>bidirectional</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>True = bidirectional scanning.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>usecs_per_line</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Microseconds per scan line.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>fill_fraction</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Raster scan temporal fill fraction (see
scanimage)</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>scan_datetime</code></td>
          <td>
                <code><span title="datetime.datetime">datetime</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Datetime of the scan.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>scan_duration</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Duration of the scan (s).</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>bidirectional_z</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>True = bidirectional z-scan.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>


        <details class="quote">
          <summary>Source code in <code>element_calcium_imaging/scan.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@schema</span>
<span class="k">class</span> <span class="nc">ScanInfo</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">Imported</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Information about the scan extracted from the recorded files.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        Scan (foreign key): A primary key from Scan.</span>
<span class="sd">        nfields (int): Number of fields.</span>
<span class="sd">        nchannels (int): Number of channels.</span>
<span class="sd">        ndepths (int): Number of scanning depths (planes).</span>
<span class="sd">        nframes (int): Number of recorded frames.</span>
<span class="sd">        nrois (int): Number of ROIs (see scanimage&#39;s multi ROI imaging).</span>
<span class="sd">        x (float, optional): ScanImage&#39;s 0 point in the motor coordinate system (um).</span>
<span class="sd">        y (float, optional): ScanImage&#39;s 0 point in the motor coordinate system (um).</span>
<span class="sd">        z (float, optional): ScanImage&#39;s 0 point in the motor coordinate system (um).</span>
<span class="sd">        fps (float) : Frames per second (Hz) - Volumetric Scan Rate.</span>
<span class="sd">        bidirectional (bool): True = bidirectional scanning.</span>
<span class="sd">        usecs_per_line (float, optional): Microseconds per scan line.</span>
<span class="sd">        fill_fraction (float, optional): Raster scan temporal fill fraction (see</span>
<span class="sd">            scanimage)</span>
<span class="sd">        scan_datetime (datetime, optional): Datetime of the scan.</span>
<span class="sd">        scan_duration (float, optional): Duration of the scan (s).</span>
<span class="sd">        bidirectional_z (bool, optional): True = bidirectional z-scan.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot; # General data about the resoscans/mesoscans from header</span>
<span class="s2">    -&gt; Scan</span>
<span class="s2">    ---</span>
<span class="s2">    nfields              : tinyint   # number of fields</span>
<span class="s2">    nchannels            : tinyint   # number of channels</span>
<span class="s2">    ndepths              : int       # Number of scanning depths (planes)</span>
<span class="s2">    nframes              : int       # number of recorded frames</span>
<span class="s2">    nrois                : tinyint   # number of ROIs (see scanimage&#39;s multi ROI imaging)</span>
<span class="s2">    x=null               : float     # (um) ScanImage&#39;s 0 point in the motor coordinate system</span>
<span class="s2">    y=null               : float     # (um) ScanImage&#39;s 0 point in the motor coordinate system</span>
<span class="s2">    z=null               : float     # (um) ScanImage&#39;s 0 point in the motor coordinate system</span>
<span class="s2">    fps                  : float     # (Hz) frames per second - Volumetric Scan Rate</span>
<span class="s2">    bidirectional        : boolean   # true = bidirectional scanning</span>
<span class="s2">    usecs_per_line=null  : float     # microseconds per scan line</span>
<span class="s2">    fill_fraction=null   : float     # raster scan temporal fill fraction (see scanimage)</span>
<span class="s2">    scan_datetime=null   : datetime  # datetime of the scan</span>
<span class="s2">    scan_duration=null   : float     # (seconds) duration of the scan</span>
<span class="s2">    bidirectional_z=null : boolean   # true = bidirectional z-scan</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="k">class</span> <span class="nc">Field</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">Part</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Stores field information of scan, including its coordinates, size, pixel</span>
<span class="sd">        pitch, etc.</span>

<span class="sd">        Attributes:</span>
<span class="sd">            ScanInfo (foreign key): A primary key from ScanInfo.</span>
<span class="sd">            field_idx (int): Unique field index.</span>
<span class="sd">            px_height (int): Image height in pixels.</span>
<span class="sd">            px_width (int): Image width in pixels.</span>
<span class="sd">            um_height (float, optional): Image height in microns.</span>
<span class="sd">            um_width (float, optional): Image width in microns.</span>
<span class="sd">            field_x (float, optional): X coordinate of the center of field in the motor</span>
<span class="sd">                coordinate system (um).</span>
<span class="sd">            field_y (float, optional): Y coordinate of the center of field in the motor</span>
<span class="sd">                coordinate system (um).</span>
<span class="sd">            field_z (float, optional): Relative depth of field (um).</span>
<span class="sd">            delay_image (longblob, optional): Delay between the start of the scan and</span>
<span class="sd">                pixels in this field (ms).</span>
<span class="sd">            roi (int, optional): The scanning roi (as recorded in the acquisition</span>
<span class="sd">                software) containing this field - only relevant to mesoscale scans.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot; # field-specific scan information</span>
<span class="s2">        -&gt; master</span>
<span class="s2">        field_idx         : int</span>
<span class="s2">        ---</span>
<span class="s2">        px_height         : smallint  # height in pixels</span>
<span class="s2">        px_width          : smallint  # width in pixels</span>
<span class="s2">        um_height=null    : float     # height in microns</span>
<span class="s2">        um_width=null     : float     # width in microns</span>
<span class="s2">        field_x=null      : float     # (um) center of field in the motor coordinate system</span>
<span class="s2">        field_y=null      : float     # (um) center of field in the motor coordinate system</span>
<span class="s2">        field_z=null      : float     # (um) relative depth of field</span>
<span class="s2">        delay_image=null  : longblob  # (ms) delay between the start of the scan and pixels in this field</span>
<span class="s2">        roi=null          : int       # the scanning roi (as recorded in the acquisition software) containing this field - only relevant to mesoscale scans</span>
<span class="s2">        &quot;&quot;&quot;</span>

    <span class="k">class</span> <span class="nc">ScanFile</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">Part</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Filepath of the scan relative to root data directory.</span>

<span class="sd">        Attributes:</span>
<span class="sd">            ScanInfo (foreign key): A primary key from ScanInfo.</span>
<span class="sd">            file_path (str): Path of the scan file relative to the root data directory.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        -&gt; master</span>
<span class="s2">        file_path: varchar(255)  # Filepath relative to root data directory</span>
<span class="s2">        &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">make</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Populate the ScanInfo with the information parsed from image files.&quot;&quot;&quot;</span>

        <span class="n">acq_software</span> <span class="o">=</span> <span class="p">(</span><span class="n">Scan</span> <span class="o">&amp;</span> <span class="n">key</span><span class="p">)</span><span class="o">.</span><span class="n">fetch1</span><span class="p">(</span><span class="s2">&quot;acq_software&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">acq_software</span> <span class="o">==</span> <span class="s2">&quot;ScanImage&quot;</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">scanreader</span>

            <span class="c1"># Read the scan</span>
            <span class="n">scan_filepaths</span> <span class="o">=</span> <span class="n">get_image_files</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s2">&quot;*.tif&quot;</span><span class="p">)</span>
            <span class="n">scan</span> <span class="o">=</span> <span class="n">scanreader</span><span class="o">.</span><span class="n">read_scan</span><span class="p">(</span><span class="n">scan_filepaths</span><span class="p">)</span>

            <span class="c1"># Insert in ScanInfo</span>
            <span class="n">x_zero</span><span class="p">,</span> <span class="n">y_zero</span><span class="p">,</span> <span class="n">z_zero</span> <span class="o">=</span> <span class="n">scan</span><span class="o">.</span><span class="n">motor_position_at_zero</span> <span class="ow">or</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">insert1</span><span class="p">(</span>
                <span class="nb">dict</span><span class="p">(</span>
                    <span class="n">key</span><span class="p">,</span>
                    <span class="n">nfields</span><span class="o">=</span><span class="n">scan</span><span class="o">.</span><span class="n">num_fields</span><span class="p">,</span>
                    <span class="n">nchannels</span><span class="o">=</span><span class="n">scan</span><span class="o">.</span><span class="n">num_channels</span><span class="p">,</span>
                    <span class="n">nframes</span><span class="o">=</span><span class="n">scan</span><span class="o">.</span><span class="n">num_frames</span><span class="p">,</span>
                    <span class="n">ndepths</span><span class="o">=</span><span class="n">scan</span><span class="o">.</span><span class="n">num_scanning_depths</span><span class="p">,</span>
                    <span class="n">x</span><span class="o">=</span><span class="n">x_zero</span><span class="p">,</span>
                    <span class="n">y</span><span class="o">=</span><span class="n">y_zero</span><span class="p">,</span>
                    <span class="n">z</span><span class="o">=</span><span class="n">z_zero</span><span class="p">,</span>
                    <span class="n">fps</span><span class="o">=</span><span class="n">scan</span><span class="o">.</span><span class="n">fps</span><span class="p">,</span>
                    <span class="n">bidirectional</span><span class="o">=</span><span class="n">scan</span><span class="o">.</span><span class="n">is_bidirectional</span><span class="p">,</span>
                    <span class="n">usecs_per_line</span><span class="o">=</span><span class="n">scan</span><span class="o">.</span><span class="n">seconds_per_line</span> <span class="o">*</span> <span class="mf">1e6</span><span class="p">,</span>
                    <span class="n">fill_fraction</span><span class="o">=</span><span class="n">scan</span><span class="o">.</span><span class="n">temporal_fill_fraction</span><span class="p">,</span>
                    <span class="n">nrois</span><span class="o">=</span><span class="n">scan</span><span class="o">.</span><span class="n">num_rois</span> <span class="k">if</span> <span class="n">scan</span><span class="o">.</span><span class="n">is_multiROI</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
                    <span class="n">scan_duration</span><span class="o">=</span><span class="n">scan</span><span class="o">.</span><span class="n">num_frames</span> <span class="o">/</span> <span class="n">scan</span><span class="o">.</span><span class="n">fps</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="c1"># Insert Field(s)</span>
            <span class="k">if</span> <span class="n">scan</span><span class="o">.</span><span class="n">is_multiROI</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Field</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="nb">dict</span><span class="p">(</span>
                            <span class="n">key</span><span class="p">,</span>
                            <span class="n">field_idx</span><span class="o">=</span><span class="n">field_id</span><span class="p">,</span>
                            <span class="n">px_height</span><span class="o">=</span><span class="n">scan</span><span class="o">.</span><span class="n">field_heights</span><span class="p">[</span><span class="n">field_id</span><span class="p">],</span>
                            <span class="n">px_width</span><span class="o">=</span><span class="n">scan</span><span class="o">.</span><span class="n">field_widths</span><span class="p">[</span><span class="n">field_id</span><span class="p">],</span>
                            <span class="n">um_height</span><span class="o">=</span><span class="n">scan</span><span class="o">.</span><span class="n">field_heights_in_microns</span><span class="p">[</span><span class="n">field_id</span><span class="p">],</span>
                            <span class="n">um_width</span><span class="o">=</span><span class="n">scan</span><span class="o">.</span><span class="n">field_widths_in_microns</span><span class="p">[</span><span class="n">field_id</span><span class="p">],</span>
                            <span class="n">field_x</span><span class="o">=</span><span class="n">x_zero</span>
                            <span class="o">+</span> <span class="n">scan</span><span class="o">.</span><span class="n">_degrees_to_microns</span><span class="p">(</span><span class="n">scan</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="n">field_id</span><span class="p">]</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">x_zero</span>
                            <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                            <span class="n">field_y</span><span class="o">=</span><span class="n">y_zero</span>
                            <span class="o">+</span> <span class="n">scan</span><span class="o">.</span><span class="n">_degrees_to_microns</span><span class="p">(</span><span class="n">scan</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="n">field_id</span><span class="p">]</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">y_zero</span>
                            <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                            <span class="n">field_z</span><span class="o">=</span><span class="n">z_zero</span> <span class="o">+</span> <span class="n">scan</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="n">field_id</span><span class="p">]</span><span class="o">.</span><span class="n">depth</span>
                            <span class="k">if</span> <span class="n">z_zero</span>
                            <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                            <span class="n">delay_image</span><span class="o">=</span><span class="n">scan</span><span class="o">.</span><span class="n">field_offsets</span><span class="p">[</span><span class="n">field_id</span><span class="p">],</span>
                            <span class="n">roi</span><span class="o">=</span><span class="n">scan</span><span class="o">.</span><span class="n">field_rois</span><span class="p">[</span><span class="n">field_id</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                        <span class="p">)</span>
                        <span class="k">for</span> <span class="n">field_id</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">scan</span><span class="o">.</span><span class="n">num_fields</span><span class="p">)</span>
                    <span class="p">]</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Field</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="nb">dict</span><span class="p">(</span>
                            <span class="n">key</span><span class="p">,</span>
                            <span class="n">field_idx</span><span class="o">=</span><span class="n">plane_idx</span><span class="p">,</span>
                            <span class="n">px_height</span><span class="o">=</span><span class="n">scan</span><span class="o">.</span><span class="n">image_height</span><span class="p">,</span>
                            <span class="n">px_width</span><span class="o">=</span><span class="n">scan</span><span class="o">.</span><span class="n">image_width</span><span class="p">,</span>
                            <span class="n">um_height</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="n">scan</span><span class="p">,</span> <span class="s2">&quot;image_height_in_microns&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
                            <span class="n">um_width</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="n">scan</span><span class="p">,</span> <span class="s2">&quot;image_width_in_microns&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
                            <span class="n">field_x</span><span class="o">=</span><span class="n">x_zero</span> <span class="k">if</span> <span class="n">x_zero</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                            <span class="n">field_y</span><span class="o">=</span><span class="n">y_zero</span> <span class="k">if</span> <span class="n">y_zero</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                            <span class="n">field_z</span><span class="o">=</span><span class="n">z_zero</span> <span class="o">+</span> <span class="n">scan</span><span class="o">.</span><span class="n">scanning_depths</span><span class="p">[</span><span class="n">plane_idx</span><span class="p">]</span>
                            <span class="k">if</span> <span class="n">z_zero</span>
                            <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                            <span class="n">delay_image</span><span class="o">=</span><span class="n">scan</span><span class="o">.</span><span class="n">field_offsets</span><span class="p">[</span><span class="n">plane_idx</span><span class="p">],</span>
                        <span class="p">)</span>
                        <span class="k">for</span> <span class="n">plane_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">scan</span><span class="o">.</span><span class="n">num_scanning_depths</span><span class="p">)</span>
                    <span class="p">]</span>
                <span class="p">)</span>
        <span class="k">elif</span> <span class="n">acq_software</span> <span class="o">==</span> <span class="s2">&quot;Scanbox&quot;</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">sbxreader</span>

            <span class="c1"># Read the scan</span>
            <span class="n">scan_filepaths</span> <span class="o">=</span> <span class="n">get_image_files</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s2">&quot;*.sbx&quot;</span><span class="p">)</span>
            <span class="n">sbx_meta</span> <span class="o">=</span> <span class="n">sbxreader</span><span class="o">.</span><span class="n">sbx_get_metadata</span><span class="p">(</span><span class="n">scan_filepaths</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">sbx_matinfo</span> <span class="o">=</span> <span class="n">sbxreader</span><span class="o">.</span><span class="n">sbx_get_info</span><span class="p">(</span><span class="n">scan_filepaths</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">is_multiROI</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span>
                <span class="n">sbx_matinfo</span><span class="o">.</span><span class="n">mesoscope</span><span class="o">.</span><span class="n">enabled</span>
            <span class="p">)</span>  <span class="c1"># currently not handling &quot;multiROI&quot; ingestion</span>

            <span class="k">if</span> <span class="n">is_multiROI</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                    <span class="s2">&quot;Loading routine not implemented for Scanbox multiROI scan mode&quot;</span>
                <span class="p">)</span>

            <span class="c1"># Insert in ScanInfo</span>
            <span class="n">x_zero</span><span class="p">,</span> <span class="n">y_zero</span><span class="p">,</span> <span class="n">z_zero</span> <span class="o">=</span> <span class="n">sbx_meta</span><span class="p">[</span><span class="s2">&quot;stage_pos&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">insert1</span><span class="p">(</span>
                <span class="nb">dict</span><span class="p">(</span>
                    <span class="n">key</span><span class="p">,</span>
                    <span class="n">nfields</span><span class="o">=</span><span class="n">sbx_meta</span><span class="p">[</span><span class="s2">&quot;num_fields&quot;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">is_multiROI</span>
                    <span class="k">else</span> <span class="n">sbx_meta</span><span class="p">[</span><span class="s2">&quot;num_planes&quot;</span><span class="p">],</span>
                    <span class="n">nchannels</span><span class="o">=</span><span class="n">sbx_meta</span><span class="p">[</span><span class="s2">&quot;num_channels&quot;</span><span class="p">],</span>
                    <span class="n">nframes</span><span class="o">=</span><span class="n">sbx_meta</span><span class="p">[</span><span class="s2">&quot;num_frames&quot;</span><span class="p">],</span>
                    <span class="n">ndepths</span><span class="o">=</span><span class="n">sbx_meta</span><span class="p">[</span><span class="s2">&quot;num_planes&quot;</span><span class="p">],</span>
                    <span class="n">x</span><span class="o">=</span><span class="n">x_zero</span><span class="p">,</span>
                    <span class="n">y</span><span class="o">=</span><span class="n">y_zero</span><span class="p">,</span>
                    <span class="n">z</span><span class="o">=</span><span class="n">z_zero</span><span class="p">,</span>
                    <span class="n">fps</span><span class="o">=</span><span class="n">sbx_meta</span><span class="p">[</span><span class="s2">&quot;frame_rate&quot;</span><span class="p">],</span>
                    <span class="n">bidirectional</span><span class="o">=</span><span class="n">sbx_meta</span> <span class="o">==</span> <span class="s2">&quot;bidirectional&quot;</span><span class="p">,</span>
                    <span class="n">nrois</span><span class="o">=</span><span class="n">sbx_meta</span><span class="p">[</span><span class="s2">&quot;num_rois&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">is_multiROI</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
                    <span class="n">scan_duration</span><span class="o">=</span><span class="p">(</span><span class="n">sbx_meta</span><span class="p">[</span><span class="s2">&quot;num_frames&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">sbx_meta</span><span class="p">[</span><span class="s2">&quot;frame_rate&quot;</span><span class="p">]),</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="c1"># Insert Field(s)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">is_multiROI</span><span class="p">:</span>
                <span class="n">px_width</span><span class="p">,</span> <span class="n">px_height</span> <span class="o">=</span> <span class="n">sbx_meta</span><span class="p">[</span><span class="s2">&quot;frame_size&quot;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Field</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="nb">dict</span><span class="p">(</span>
                            <span class="n">key</span><span class="p">,</span>
                            <span class="n">field_idx</span><span class="o">=</span><span class="n">plane_idx</span><span class="p">,</span>
                            <span class="n">px_height</span><span class="o">=</span><span class="n">px_height</span><span class="p">,</span>
                            <span class="n">px_width</span><span class="o">=</span><span class="n">px_width</span><span class="p">,</span>
                            <span class="n">um_height</span><span class="o">=</span><span class="n">px_height</span> <span class="o">*</span> <span class="n">sbx_meta</span><span class="p">[</span><span class="s2">&quot;um_per_pixel_y&quot;</span><span class="p">]</span>
                            <span class="k">if</span> <span class="n">sbx_meta</span><span class="p">[</span><span class="s2">&quot;um_per_pixel_y&quot;</span><span class="p">]</span>
                            <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                            <span class="n">um_width</span><span class="o">=</span><span class="n">px_width</span> <span class="o">*</span> <span class="n">sbx_meta</span><span class="p">[</span><span class="s2">&quot;um_per_pixel_x&quot;</span><span class="p">]</span>
                            <span class="k">if</span> <span class="n">sbx_meta</span><span class="p">[</span><span class="s2">&quot;um_per_pixel_x&quot;</span><span class="p">]</span>
                            <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                            <span class="n">field_x</span><span class="o">=</span><span class="n">x_zero</span><span class="p">,</span>
                            <span class="n">field_y</span><span class="o">=</span><span class="n">y_zero</span><span class="p">,</span>
                            <span class="n">field_z</span><span class="o">=</span><span class="n">z_zero</span> <span class="o">+</span> <span class="n">sbx_meta</span><span class="p">[</span><span class="s2">&quot;etl_pos&quot;</span><span class="p">][</span><span class="n">plane_idx</span><span class="p">],</span>
                        <span class="p">)</span>
                        <span class="k">for</span> <span class="n">plane_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">sbx_meta</span><span class="p">[</span><span class="s2">&quot;num_planes&quot;</span><span class="p">])</span>
                    <span class="p">]</span>
                <span class="p">)</span>
        <span class="k">elif</span> <span class="n">acq_software</span> <span class="o">==</span> <span class="s2">&quot;NIS&quot;</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">nd2</span>

            <span class="c1"># Read the scan</span>
            <span class="n">scan_filepaths</span> <span class="o">=</span> <span class="n">get_image_files</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s2">&quot;*.nd2&quot;</span><span class="p">)</span>
            <span class="n">nd2_file</span> <span class="o">=</span> <span class="n">nd2</span><span class="o">.</span><span class="n">ND2File</span><span class="p">(</span><span class="n">scan_filepaths</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">is_multiROI</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># MultiROI to be implemented later</span>

            <span class="c1"># Frame per second</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">fps</span> <span class="o">=</span> <span class="mi">1000</span> <span class="o">/</span> <span class="n">nd2_file</span><span class="o">.</span><span class="n">experiment</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">periods</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">periodDiff</span><span class="o">.</span><span class="n">avg</span>
            <span class="k">except</span><span class="p">:</span>  <span class="c1"># noqa: E722</span>
                <span class="n">fps</span> <span class="o">=</span> <span class="mi">1000</span> <span class="o">/</span> <span class="n">nd2_file</span><span class="o">.</span><span class="n">experiment</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">periodDiff</span><span class="o">.</span><span class="n">avg</span>

            <span class="c1"># Estimate ND2 file scan duration</span>
            <span class="k">def</span> <span class="nf">estimate_nd2_scan_duration</span><span class="p">(</span><span class="n">nd2_scan_obj</span><span class="p">):</span>
                <span class="c1"># Calculates scan duration for Nikon images</span>
                <span class="n">ti</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">nd2_scan_obj</span><span class="o">.</span><span class="n">frame_metadata</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">channels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">absoluteJulianDayNumber</span>
                <span class="p">)</span>  <span class="c1"># Initial frame&#39;s JD.</span>
                <span class="n">tf</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">nd2_scan_obj</span><span class="o">.</span><span class="n">frame_metadata</span><span class="p">(</span><span class="n">nd2_scan_obj</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="o">.</span><span class="n">channels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">absoluteJulianDayNumber</span>
                <span class="p">)</span>  <span class="c1"># Final frame&#39;s JD.</span>

                <span class="k">return</span> <span class="p">(</span><span class="n">tf</span> <span class="o">-</span> <span class="n">ti</span><span class="p">)</span> <span class="o">*</span> <span class="mi">86400</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">fps</span>

            <span class="n">scan_duration</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span>
                <span class="n">estimate_nd2_scan_duration</span><span class="p">(</span><span class="n">nd2</span><span class="o">.</span><span class="n">ND2File</span><span class="p">(</span><span class="n">f</span><span class="p">))</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">scan_filepaths</span>
            <span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">scan_datetime</span> <span class="o">=</span> <span class="n">nd2_file</span><span class="o">.</span><span class="n">text_info</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">]</span>
                <span class="n">scan_datetime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span>
                    <span class="n">scan_datetime</span><span class="p">,</span>
                    <span class="s2">&quot;%m/</span><span class="si">%d</span><span class="s2">/%Y %H:%M:%S %p&quot;</span>
                    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">((</span><span class="s2">&quot;AM|PM&quot;</span><span class="p">),</span> <span class="n">scan_datetime</span><span class="p">)</span>
                    <span class="k">else</span> <span class="s2">&quot;%m/</span><span class="si">%d</span><span class="s2">/%Y %H:%M:%S&quot;</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">scan_datetime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">scan_datetime</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>  <span class="c1"># noqa: E722</span>
                <span class="n">scan_datetime</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="c1"># Insert in ScanInfo</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">insert1</span><span class="p">(</span>
                <span class="nb">dict</span><span class="p">(</span>
                    <span class="n">key</span><span class="p">,</span>
                    <span class="n">nfields</span><span class="o">=</span><span class="n">nd2_file</span><span class="o">.</span><span class="n">sizes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;P&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                    <span class="n">nchannels</span><span class="o">=</span><span class="n">nd2_file</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">channelCount</span><span class="p">,</span>
                    <span class="n">nframes</span><span class="o">=</span><span class="n">nd2_file</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">contents</span><span class="o">.</span><span class="n">frameCount</span><span class="p">,</span>
                    <span class="n">ndepths</span><span class="o">=</span><span class="n">nd2_file</span><span class="o">.</span><span class="n">sizes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Z&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                    <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">z</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">fps</span><span class="o">=</span><span class="n">fps</span><span class="p">,</span>
                    <span class="n">bidirectional</span><span class="o">=</span><span class="nb">bool</span><span class="p">(</span>
                        <span class="n">nd2_file</span><span class="o">.</span><span class="n">custom_data</span><span class="p">[</span><span class="s2">&quot;GrabberCameraSettingsV1_0&quot;</span><span class="p">][</span>
                            <span class="s2">&quot;GrabberCameraSettings&quot;</span>
                        <span class="p">][</span><span class="s2">&quot;PropertiesQuality&quot;</span><span class="p">][</span><span class="s2">&quot;ScanDirection&quot;</span><span class="p">]</span>
                    <span class="p">),</span>
                    <span class="n">nrois</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                    <span class="n">scan_datetime</span><span class="o">=</span><span class="n">scan_datetime</span><span class="p">,</span>
                    <span class="n">scan_duration</span><span class="o">=</span><span class="n">scan_duration</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>

            <span class="c1"># MultiROI to be implemented later</span>

            <span class="c1"># Insert in Field</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">is_multiROI</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Field</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="nb">dict</span><span class="p">(</span>
                            <span class="n">key</span><span class="p">,</span>
                            <span class="n">field_idx</span><span class="o">=</span><span class="n">plane_idx</span><span class="p">,</span>
                            <span class="n">px_height</span><span class="o">=</span><span class="n">nd2_file</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">heightPx</span><span class="p">,</span>
                            <span class="n">px_width</span><span class="o">=</span><span class="n">nd2_file</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">widthPx</span><span class="p">,</span>
                            <span class="n">um_height</span><span class="o">=</span><span class="n">nd2_file</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">heightPx</span>
                            <span class="o">*</span> <span class="n">nd2_file</span><span class="o">.</span><span class="n">voxel_size</span><span class="p">()</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
                            <span class="n">um_width</span><span class="o">=</span><span class="n">nd2_file</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">widthPx</span>
                            <span class="o">*</span> <span class="n">nd2_file</span><span class="o">.</span><span class="n">voxel_size</span><span class="p">()</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
                            <span class="n">field_x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                            <span class="n">field_y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                            <span class="n">field_z</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="p">)</span>
                        <span class="k">for</span> <span class="n">plane_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nd2_file</span><span class="o">.</span><span class="n">sizes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Z&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
                    <span class="p">]</span>
                <span class="p">)</span>
        <span class="k">elif</span> <span class="n">acq_software</span> <span class="o">==</span> <span class="s2">&quot;PrairieView&quot;</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">element_interface</span> <span class="kn">import</span> <span class="n">prairieviewreader</span>

            <span class="n">scan_filepaths</span> <span class="o">=</span> <span class="n">get_image_files</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s2">&quot;*.tif&quot;</span><span class="p">)</span>
            <span class="n">PVScan_info</span> <span class="o">=</span> <span class="n">prairieviewreader</span><span class="o">.</span><span class="n">get_pv_metadata</span><span class="p">(</span><span class="n">scan_filepaths</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">insert1</span><span class="p">(</span>
                <span class="nb">dict</span><span class="p">(</span>
                    <span class="n">key</span><span class="p">,</span>
                    <span class="n">nfields</span><span class="o">=</span><span class="n">PVScan_info</span><span class="p">[</span><span class="s2">&quot;num_fields&quot;</span><span class="p">],</span>
                    <span class="n">nchannels</span><span class="o">=</span><span class="n">PVScan_info</span><span class="p">[</span><span class="s2">&quot;num_channels&quot;</span><span class="p">],</span>
                    <span class="n">ndepths</span><span class="o">=</span><span class="n">PVScan_info</span><span class="p">[</span><span class="s2">&quot;num_planes&quot;</span><span class="p">],</span>
                    <span class="n">nframes</span><span class="o">=</span><span class="n">PVScan_info</span><span class="p">[</span><span class="s2">&quot;num_frames&quot;</span><span class="p">],</span>
                    <span class="n">nrois</span><span class="o">=</span><span class="n">PVScan_info</span><span class="p">[</span><span class="s2">&quot;num_rois&quot;</span><span class="p">],</span>
                    <span class="n">x</span><span class="o">=</span><span class="n">PVScan_info</span><span class="p">[</span><span class="s2">&quot;x_pos&quot;</span><span class="p">],</span>
                    <span class="n">y</span><span class="o">=</span><span class="n">PVScan_info</span><span class="p">[</span><span class="s2">&quot;y_pos&quot;</span><span class="p">],</span>
                    <span class="n">z</span><span class="o">=</span><span class="n">PVScan_info</span><span class="p">[</span><span class="s2">&quot;z_pos&quot;</span><span class="p">],</span>
                    <span class="n">fps</span><span class="o">=</span><span class="n">PVScan_info</span><span class="p">[</span><span class="s2">&quot;frame_rate&quot;</span><span class="p">],</span>
                    <span class="n">bidirectional</span><span class="o">=</span><span class="n">PVScan_info</span><span class="p">[</span><span class="s2">&quot;bidirectional&quot;</span><span class="p">],</span>
                    <span class="n">bidirectional_z</span><span class="o">=</span><span class="n">PVScan_info</span><span class="p">[</span><span class="s2">&quot;bidirectional_z&quot;</span><span class="p">],</span>
                    <span class="n">usecs_per_line</span><span class="o">=</span><span class="n">PVScan_info</span><span class="p">[</span><span class="s2">&quot;usecs_per_line&quot;</span><span class="p">],</span>
                    <span class="n">scan_datetime</span><span class="o">=</span><span class="n">PVScan_info</span><span class="p">[</span><span class="s2">&quot;scan_datetime&quot;</span><span class="p">],</span>
                    <span class="n">scan_duration</span><span class="o">=</span><span class="n">PVScan_info</span><span class="p">[</span><span class="s2">&quot;scan_duration&quot;</span><span class="p">],</span>
                <span class="p">)</span>
            <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">Field</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span>
                <span class="nb">dict</span><span class="p">(</span>
                    <span class="n">key</span><span class="p">,</span>
                    <span class="n">field_idx</span><span class="o">=</span><span class="n">plane_idx</span><span class="p">,</span>
                    <span class="n">px_height</span><span class="o">=</span><span class="n">PVScan_info</span><span class="p">[</span><span class="s2">&quot;height_in_pixels&quot;</span><span class="p">],</span>
                    <span class="n">px_width</span><span class="o">=</span><span class="n">PVScan_info</span><span class="p">[</span><span class="s2">&quot;width_in_pixels&quot;</span><span class="p">],</span>
                    <span class="n">um_height</span><span class="o">=</span><span class="n">PVScan_info</span><span class="p">[</span><span class="s2">&quot;height_in_um&quot;</span><span class="p">],</span>
                    <span class="n">um_width</span><span class="o">=</span><span class="n">PVScan_info</span><span class="p">[</span><span class="s2">&quot;width_in_um&quot;</span><span class="p">],</span>
                    <span class="n">field_x</span><span class="o">=</span><span class="n">PVScan_info</span><span class="p">[</span><span class="s2">&quot;fieldX&quot;</span><span class="p">],</span>
                    <span class="n">field_y</span><span class="o">=</span><span class="n">PVScan_info</span><span class="p">[</span><span class="s2">&quot;fieldY&quot;</span><span class="p">],</span>
                    <span class="n">field_z</span><span class="o">=</span><span class="n">PVScan_info</span><span class="p">[</span><span class="s2">&quot;fieldZ&quot;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">PVScan_info</span><span class="p">[</span><span class="s2">&quot;num_planes&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span>
                    <span class="k">else</span> <span class="n">PVScan_info</span><span class="p">[</span><span class="s2">&quot;fieldZ&quot;</span><span class="p">][</span><span class="n">plane_idx</span><span class="p">],</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">plane_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">PVScan_info</span><span class="p">[</span><span class="s2">&quot;num_planes&quot;</span><span class="p">])</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Loading routine not implemented for </span><span class="si">{</span><span class="n">acq_software</span><span class="si">}</span><span class="s2"> &quot;</span>
                <span class="s2">&quot;acquisition software&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Insert file(s)</span>
        <span class="n">root_dir</span> <span class="o">=</span> <span class="n">find_root_directory</span><span class="p">(</span><span class="n">get_imaging_root_data_dir</span><span class="p">(),</span> <span class="n">scan_filepaths</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="n">scan_files</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">.</span><span class="n">relative_to</span><span class="p">(</span><span class="n">root_dir</span><span class="p">)</span><span class="o">.</span><span class="n">as_posix</span><span class="p">()</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">scan_filepaths</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ScanFile</span><span class="o">.</span><span class="n">insert</span><span class="p">([{</span><span class="o">**</span><span class="n">key</span><span class="p">,</span> <span class="s2">&quot;file_path&quot;</span><span class="p">:</span> <span class="n">f</span><span class="p">}</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">scan_files</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">







<div class="doc doc-object doc-class">



<h3 id="element_calcium_imaging.scan.ScanInfo.Field" class="doc doc-heading">
        <code>Field</code>


<a href="#element_calcium_imaging.scan.ScanInfo.Field" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="datajoint">dj</span>.<span title="datajoint.Part">Part</span></code></p>

  
      <p>Stores field information of scan, including its coordinates, size, pixel
pitch, etc.</p>

  <p><strong>Attributes:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>ScanInfo</code></td>
          <td>
                <code>foreign key</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A primary key from ScanInfo.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>field_idx</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Unique field index.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>px_height</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Image height in pixels.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>px_width</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Image width in pixels.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>um_height</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Image height in microns.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>um_width</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Image width in microns.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>field_x</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>X coordinate of the center of field in the motor
coordinate system (um).</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>field_y</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Y coordinate of the center of field in the motor
coordinate system (um).</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>field_z</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Relative depth of field (um).</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>delay_image</code></td>
          <td>
                <code>longblob</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Delay between the start of the scan and
pixels in this field (ms).</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>roi</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The scanning roi (as recorded in the acquisition
software) containing this field - only relevant to mesoscale scans.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>


        <details class="quote">
          <summary>Source code in <code>element_calcium_imaging/scan.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Field</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">Part</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Stores field information of scan, including its coordinates, size, pixel</span>
<span class="sd">    pitch, etc.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        ScanInfo (foreign key): A primary key from ScanInfo.</span>
<span class="sd">        field_idx (int): Unique field index.</span>
<span class="sd">        px_height (int): Image height in pixels.</span>
<span class="sd">        px_width (int): Image width in pixels.</span>
<span class="sd">        um_height (float, optional): Image height in microns.</span>
<span class="sd">        um_width (float, optional): Image width in microns.</span>
<span class="sd">        field_x (float, optional): X coordinate of the center of field in the motor</span>
<span class="sd">            coordinate system (um).</span>
<span class="sd">        field_y (float, optional): Y coordinate of the center of field in the motor</span>
<span class="sd">            coordinate system (um).</span>
<span class="sd">        field_z (float, optional): Relative depth of field (um).</span>
<span class="sd">        delay_image (longblob, optional): Delay between the start of the scan and</span>
<span class="sd">            pixels in this field (ms).</span>
<span class="sd">        roi (int, optional): The scanning roi (as recorded in the acquisition</span>
<span class="sd">            software) containing this field - only relevant to mesoscale scans.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot; # field-specific scan information</span>
<span class="s2">    -&gt; master</span>
<span class="s2">    field_idx         : int</span>
<span class="s2">    ---</span>
<span class="s2">    px_height         : smallint  # height in pixels</span>
<span class="s2">    px_width          : smallint  # width in pixels</span>
<span class="s2">    um_height=null    : float     # height in microns</span>
<span class="s2">    um_width=null     : float     # width in microns</span>
<span class="s2">    field_x=null      : float     # (um) center of field in the motor coordinate system</span>
<span class="s2">    field_y=null      : float     # (um) center of field in the motor coordinate system</span>
<span class="s2">    field_z=null      : float     # (um) relative depth of field</span>
<span class="s2">    delay_image=null  : longblob  # (ms) delay between the start of the scan and pixels in this field</span>
<span class="s2">    roi=null          : int       # the scanning roi (as recorded in the acquisition software) containing this field - only relevant to mesoscale scans</span>
<span class="s2">    &quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">





  </div>

  </div>

</div>






<div class="doc doc-object doc-class">



<h3 id="element_calcium_imaging.scan.ScanInfo.ScanFile" class="doc doc-heading">
        <code>ScanFile</code>


<a href="#element_calcium_imaging.scan.ScanInfo.ScanFile" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="datajoint">dj</span>.<span title="datajoint.Part">Part</span></code></p>

  
      <p>Filepath of the scan relative to root data directory.</p>

  <p><strong>Attributes:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>ScanInfo</code></td>
          <td>
                <code>foreign key</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A primary key from ScanInfo.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>file_path</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Path of the scan file relative to the root data directory.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>


        <details class="quote">
          <summary>Source code in <code>element_calcium_imaging/scan.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ScanFile</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">Part</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Filepath of the scan relative to root data directory.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        ScanInfo (foreign key): A primary key from ScanInfo.</span>
<span class="sd">        file_path (str): Path of the scan file relative to the root data directory.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    -&gt; master</span>
<span class="s2">    file_path: varchar(255)  # Filepath relative to root data directory</span>
<span class="s2">    &quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">





  </div>

  </div>

</div>






<div class="doc doc-object doc-function">



<h3 id="element_calcium_imaging.scan.ScanInfo.make" class="doc doc-heading">
<code class="highlight language-python"><span class="n">make</span><span class="p">(</span><span class="n">key</span><span class="p">)</span></code>

<a href="#element_calcium_imaging.scan.ScanInfo.make" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>Populate the ScanInfo with the information parsed from image files.</p>

      <details class="quote">
        <summary>Source code in <code>element_calcium_imaging/scan.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">make</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Populate the ScanInfo with the information parsed from image files.&quot;&quot;&quot;</span>

    <span class="n">acq_software</span> <span class="o">=</span> <span class="p">(</span><span class="n">Scan</span> <span class="o">&amp;</span> <span class="n">key</span><span class="p">)</span><span class="o">.</span><span class="n">fetch1</span><span class="p">(</span><span class="s2">&quot;acq_software&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">acq_software</span> <span class="o">==</span> <span class="s2">&quot;ScanImage&quot;</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">scanreader</span>

        <span class="c1"># Read the scan</span>
        <span class="n">scan_filepaths</span> <span class="o">=</span> <span class="n">get_image_files</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s2">&quot;*.tif&quot;</span><span class="p">)</span>
        <span class="n">scan</span> <span class="o">=</span> <span class="n">scanreader</span><span class="o">.</span><span class="n">read_scan</span><span class="p">(</span><span class="n">scan_filepaths</span><span class="p">)</span>

        <span class="c1"># Insert in ScanInfo</span>
        <span class="n">x_zero</span><span class="p">,</span> <span class="n">y_zero</span><span class="p">,</span> <span class="n">z_zero</span> <span class="o">=</span> <span class="n">scan</span><span class="o">.</span><span class="n">motor_position_at_zero</span> <span class="ow">or</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">insert1</span><span class="p">(</span>
            <span class="nb">dict</span><span class="p">(</span>
                <span class="n">key</span><span class="p">,</span>
                <span class="n">nfields</span><span class="o">=</span><span class="n">scan</span><span class="o">.</span><span class="n">num_fields</span><span class="p">,</span>
                <span class="n">nchannels</span><span class="o">=</span><span class="n">scan</span><span class="o">.</span><span class="n">num_channels</span><span class="p">,</span>
                <span class="n">nframes</span><span class="o">=</span><span class="n">scan</span><span class="o">.</span><span class="n">num_frames</span><span class="p">,</span>
                <span class="n">ndepths</span><span class="o">=</span><span class="n">scan</span><span class="o">.</span><span class="n">num_scanning_depths</span><span class="p">,</span>
                <span class="n">x</span><span class="o">=</span><span class="n">x_zero</span><span class="p">,</span>
                <span class="n">y</span><span class="o">=</span><span class="n">y_zero</span><span class="p">,</span>
                <span class="n">z</span><span class="o">=</span><span class="n">z_zero</span><span class="p">,</span>
                <span class="n">fps</span><span class="o">=</span><span class="n">scan</span><span class="o">.</span><span class="n">fps</span><span class="p">,</span>
                <span class="n">bidirectional</span><span class="o">=</span><span class="n">scan</span><span class="o">.</span><span class="n">is_bidirectional</span><span class="p">,</span>
                <span class="n">usecs_per_line</span><span class="o">=</span><span class="n">scan</span><span class="o">.</span><span class="n">seconds_per_line</span> <span class="o">*</span> <span class="mf">1e6</span><span class="p">,</span>
                <span class="n">fill_fraction</span><span class="o">=</span><span class="n">scan</span><span class="o">.</span><span class="n">temporal_fill_fraction</span><span class="p">,</span>
                <span class="n">nrois</span><span class="o">=</span><span class="n">scan</span><span class="o">.</span><span class="n">num_rois</span> <span class="k">if</span> <span class="n">scan</span><span class="o">.</span><span class="n">is_multiROI</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
                <span class="n">scan_duration</span><span class="o">=</span><span class="n">scan</span><span class="o">.</span><span class="n">num_frames</span> <span class="o">/</span> <span class="n">scan</span><span class="o">.</span><span class="n">fps</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="c1"># Insert Field(s)</span>
        <span class="k">if</span> <span class="n">scan</span><span class="o">.</span><span class="n">is_multiROI</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Field</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="nb">dict</span><span class="p">(</span>
                        <span class="n">key</span><span class="p">,</span>
                        <span class="n">field_idx</span><span class="o">=</span><span class="n">field_id</span><span class="p">,</span>
                        <span class="n">px_height</span><span class="o">=</span><span class="n">scan</span><span class="o">.</span><span class="n">field_heights</span><span class="p">[</span><span class="n">field_id</span><span class="p">],</span>
                        <span class="n">px_width</span><span class="o">=</span><span class="n">scan</span><span class="o">.</span><span class="n">field_widths</span><span class="p">[</span><span class="n">field_id</span><span class="p">],</span>
                        <span class="n">um_height</span><span class="o">=</span><span class="n">scan</span><span class="o">.</span><span class="n">field_heights_in_microns</span><span class="p">[</span><span class="n">field_id</span><span class="p">],</span>
                        <span class="n">um_width</span><span class="o">=</span><span class="n">scan</span><span class="o">.</span><span class="n">field_widths_in_microns</span><span class="p">[</span><span class="n">field_id</span><span class="p">],</span>
                        <span class="n">field_x</span><span class="o">=</span><span class="n">x_zero</span>
                        <span class="o">+</span> <span class="n">scan</span><span class="o">.</span><span class="n">_degrees_to_microns</span><span class="p">(</span><span class="n">scan</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="n">field_id</span><span class="p">]</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">x_zero</span>
                        <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="n">field_y</span><span class="o">=</span><span class="n">y_zero</span>
                        <span class="o">+</span> <span class="n">scan</span><span class="o">.</span><span class="n">_degrees_to_microns</span><span class="p">(</span><span class="n">scan</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="n">field_id</span><span class="p">]</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">y_zero</span>
                        <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="n">field_z</span><span class="o">=</span><span class="n">z_zero</span> <span class="o">+</span> <span class="n">scan</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="n">field_id</span><span class="p">]</span><span class="o">.</span><span class="n">depth</span>
                        <span class="k">if</span> <span class="n">z_zero</span>
                        <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="n">delay_image</span><span class="o">=</span><span class="n">scan</span><span class="o">.</span><span class="n">field_offsets</span><span class="p">[</span><span class="n">field_id</span><span class="p">],</span>
                        <span class="n">roi</span><span class="o">=</span><span class="n">scan</span><span class="o">.</span><span class="n">field_rois</span><span class="p">[</span><span class="n">field_id</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                    <span class="p">)</span>
                    <span class="k">for</span> <span class="n">field_id</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">scan</span><span class="o">.</span><span class="n">num_fields</span><span class="p">)</span>
                <span class="p">]</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Field</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="nb">dict</span><span class="p">(</span>
                        <span class="n">key</span><span class="p">,</span>
                        <span class="n">field_idx</span><span class="o">=</span><span class="n">plane_idx</span><span class="p">,</span>
                        <span class="n">px_height</span><span class="o">=</span><span class="n">scan</span><span class="o">.</span><span class="n">image_height</span><span class="p">,</span>
                        <span class="n">px_width</span><span class="o">=</span><span class="n">scan</span><span class="o">.</span><span class="n">image_width</span><span class="p">,</span>
                        <span class="n">um_height</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="n">scan</span><span class="p">,</span> <span class="s2">&quot;image_height_in_microns&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
                        <span class="n">um_width</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="n">scan</span><span class="p">,</span> <span class="s2">&quot;image_width_in_microns&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
                        <span class="n">field_x</span><span class="o">=</span><span class="n">x_zero</span> <span class="k">if</span> <span class="n">x_zero</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="n">field_y</span><span class="o">=</span><span class="n">y_zero</span> <span class="k">if</span> <span class="n">y_zero</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="n">field_z</span><span class="o">=</span><span class="n">z_zero</span> <span class="o">+</span> <span class="n">scan</span><span class="o">.</span><span class="n">scanning_depths</span><span class="p">[</span><span class="n">plane_idx</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">z_zero</span>
                        <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="n">delay_image</span><span class="o">=</span><span class="n">scan</span><span class="o">.</span><span class="n">field_offsets</span><span class="p">[</span><span class="n">plane_idx</span><span class="p">],</span>
                    <span class="p">)</span>
                    <span class="k">for</span> <span class="n">plane_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">scan</span><span class="o">.</span><span class="n">num_scanning_depths</span><span class="p">)</span>
                <span class="p">]</span>
            <span class="p">)</span>
    <span class="k">elif</span> <span class="n">acq_software</span> <span class="o">==</span> <span class="s2">&quot;Scanbox&quot;</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">sbxreader</span>

        <span class="c1"># Read the scan</span>
        <span class="n">scan_filepaths</span> <span class="o">=</span> <span class="n">get_image_files</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s2">&quot;*.sbx&quot;</span><span class="p">)</span>
        <span class="n">sbx_meta</span> <span class="o">=</span> <span class="n">sbxreader</span><span class="o">.</span><span class="n">sbx_get_metadata</span><span class="p">(</span><span class="n">scan_filepaths</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">sbx_matinfo</span> <span class="o">=</span> <span class="n">sbxreader</span><span class="o">.</span><span class="n">sbx_get_info</span><span class="p">(</span><span class="n">scan_filepaths</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">is_multiROI</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span>
            <span class="n">sbx_matinfo</span><span class="o">.</span><span class="n">mesoscope</span><span class="o">.</span><span class="n">enabled</span>
        <span class="p">)</span>  <span class="c1"># currently not handling &quot;multiROI&quot; ingestion</span>

        <span class="k">if</span> <span class="n">is_multiROI</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                <span class="s2">&quot;Loading routine not implemented for Scanbox multiROI scan mode&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Insert in ScanInfo</span>
        <span class="n">x_zero</span><span class="p">,</span> <span class="n">y_zero</span><span class="p">,</span> <span class="n">z_zero</span> <span class="o">=</span> <span class="n">sbx_meta</span><span class="p">[</span><span class="s2">&quot;stage_pos&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">insert1</span><span class="p">(</span>
            <span class="nb">dict</span><span class="p">(</span>
                <span class="n">key</span><span class="p">,</span>
                <span class="n">nfields</span><span class="o">=</span><span class="n">sbx_meta</span><span class="p">[</span><span class="s2">&quot;num_fields&quot;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">is_multiROI</span>
                <span class="k">else</span> <span class="n">sbx_meta</span><span class="p">[</span><span class="s2">&quot;num_planes&quot;</span><span class="p">],</span>
                <span class="n">nchannels</span><span class="o">=</span><span class="n">sbx_meta</span><span class="p">[</span><span class="s2">&quot;num_channels&quot;</span><span class="p">],</span>
                <span class="n">nframes</span><span class="o">=</span><span class="n">sbx_meta</span><span class="p">[</span><span class="s2">&quot;num_frames&quot;</span><span class="p">],</span>
                <span class="n">ndepths</span><span class="o">=</span><span class="n">sbx_meta</span><span class="p">[</span><span class="s2">&quot;num_planes&quot;</span><span class="p">],</span>
                <span class="n">x</span><span class="o">=</span><span class="n">x_zero</span><span class="p">,</span>
                <span class="n">y</span><span class="o">=</span><span class="n">y_zero</span><span class="p">,</span>
                <span class="n">z</span><span class="o">=</span><span class="n">z_zero</span><span class="p">,</span>
                <span class="n">fps</span><span class="o">=</span><span class="n">sbx_meta</span><span class="p">[</span><span class="s2">&quot;frame_rate&quot;</span><span class="p">],</span>
                <span class="n">bidirectional</span><span class="o">=</span><span class="n">sbx_meta</span> <span class="o">==</span> <span class="s2">&quot;bidirectional&quot;</span><span class="p">,</span>
                <span class="n">nrois</span><span class="o">=</span><span class="n">sbx_meta</span><span class="p">[</span><span class="s2">&quot;num_rois&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">is_multiROI</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
                <span class="n">scan_duration</span><span class="o">=</span><span class="p">(</span><span class="n">sbx_meta</span><span class="p">[</span><span class="s2">&quot;num_frames&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">sbx_meta</span><span class="p">[</span><span class="s2">&quot;frame_rate&quot;</span><span class="p">]),</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="c1"># Insert Field(s)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_multiROI</span><span class="p">:</span>
            <span class="n">px_width</span><span class="p">,</span> <span class="n">px_height</span> <span class="o">=</span> <span class="n">sbx_meta</span><span class="p">[</span><span class="s2">&quot;frame_size&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Field</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="nb">dict</span><span class="p">(</span>
                        <span class="n">key</span><span class="p">,</span>
                        <span class="n">field_idx</span><span class="o">=</span><span class="n">plane_idx</span><span class="p">,</span>
                        <span class="n">px_height</span><span class="o">=</span><span class="n">px_height</span><span class="p">,</span>
                        <span class="n">px_width</span><span class="o">=</span><span class="n">px_width</span><span class="p">,</span>
                        <span class="n">um_height</span><span class="o">=</span><span class="n">px_height</span> <span class="o">*</span> <span class="n">sbx_meta</span><span class="p">[</span><span class="s2">&quot;um_per_pixel_y&quot;</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">sbx_meta</span><span class="p">[</span><span class="s2">&quot;um_per_pixel_y&quot;</span><span class="p">]</span>
                        <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="n">um_width</span><span class="o">=</span><span class="n">px_width</span> <span class="o">*</span> <span class="n">sbx_meta</span><span class="p">[</span><span class="s2">&quot;um_per_pixel_x&quot;</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">sbx_meta</span><span class="p">[</span><span class="s2">&quot;um_per_pixel_x&quot;</span><span class="p">]</span>
                        <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="n">field_x</span><span class="o">=</span><span class="n">x_zero</span><span class="p">,</span>
                        <span class="n">field_y</span><span class="o">=</span><span class="n">y_zero</span><span class="p">,</span>
                        <span class="n">field_z</span><span class="o">=</span><span class="n">z_zero</span> <span class="o">+</span> <span class="n">sbx_meta</span><span class="p">[</span><span class="s2">&quot;etl_pos&quot;</span><span class="p">][</span><span class="n">plane_idx</span><span class="p">],</span>
                    <span class="p">)</span>
                    <span class="k">for</span> <span class="n">plane_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">sbx_meta</span><span class="p">[</span><span class="s2">&quot;num_planes&quot;</span><span class="p">])</span>
                <span class="p">]</span>
            <span class="p">)</span>
    <span class="k">elif</span> <span class="n">acq_software</span> <span class="o">==</span> <span class="s2">&quot;NIS&quot;</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">nd2</span>

        <span class="c1"># Read the scan</span>
        <span class="n">scan_filepaths</span> <span class="o">=</span> <span class="n">get_image_files</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s2">&quot;*.nd2&quot;</span><span class="p">)</span>
        <span class="n">nd2_file</span> <span class="o">=</span> <span class="n">nd2</span><span class="o">.</span><span class="n">ND2File</span><span class="p">(</span><span class="n">scan_filepaths</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">is_multiROI</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># MultiROI to be implemented later</span>

        <span class="c1"># Frame per second</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">fps</span> <span class="o">=</span> <span class="mi">1000</span> <span class="o">/</span> <span class="n">nd2_file</span><span class="o">.</span><span class="n">experiment</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">periods</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">periodDiff</span><span class="o">.</span><span class="n">avg</span>
        <span class="k">except</span><span class="p">:</span>  <span class="c1"># noqa: E722</span>
            <span class="n">fps</span> <span class="o">=</span> <span class="mi">1000</span> <span class="o">/</span> <span class="n">nd2_file</span><span class="o">.</span><span class="n">experiment</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">periodDiff</span><span class="o">.</span><span class="n">avg</span>

        <span class="c1"># Estimate ND2 file scan duration</span>
        <span class="k">def</span> <span class="nf">estimate_nd2_scan_duration</span><span class="p">(</span><span class="n">nd2_scan_obj</span><span class="p">):</span>
            <span class="c1"># Calculates scan duration for Nikon images</span>
            <span class="n">ti</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">nd2_scan_obj</span><span class="o">.</span><span class="n">frame_metadata</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="o">.</span><span class="n">channels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">absoluteJulianDayNumber</span>
            <span class="p">)</span>  <span class="c1"># Initial frame&#39;s JD.</span>
            <span class="n">tf</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">nd2_scan_obj</span><span class="o">.</span><span class="n">frame_metadata</span><span class="p">(</span><span class="n">nd2_scan_obj</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                <span class="o">.</span><span class="n">channels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">absoluteJulianDayNumber</span>
            <span class="p">)</span>  <span class="c1"># Final frame&#39;s JD.</span>

            <span class="k">return</span> <span class="p">(</span><span class="n">tf</span> <span class="o">-</span> <span class="n">ti</span><span class="p">)</span> <span class="o">*</span> <span class="mi">86400</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">fps</span>

        <span class="n">scan_duration</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span>
            <span class="n">estimate_nd2_scan_duration</span><span class="p">(</span><span class="n">nd2</span><span class="o">.</span><span class="n">ND2File</span><span class="p">(</span><span class="n">f</span><span class="p">))</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">scan_filepaths</span>
        <span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">scan_datetime</span> <span class="o">=</span> <span class="n">nd2_file</span><span class="o">.</span><span class="n">text_info</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">]</span>
            <span class="n">scan_datetime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span>
                <span class="n">scan_datetime</span><span class="p">,</span>
                <span class="s2">&quot;%m/</span><span class="si">%d</span><span class="s2">/%Y %H:%M:%S %p&quot;</span>
                <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">((</span><span class="s2">&quot;AM|PM&quot;</span><span class="p">),</span> <span class="n">scan_datetime</span><span class="p">)</span>
                <span class="k">else</span> <span class="s2">&quot;%m/</span><span class="si">%d</span><span class="s2">/%Y %H:%M:%S&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">scan_datetime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">scan_datetime</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>  <span class="c1"># noqa: E722</span>
            <span class="n">scan_datetime</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Insert in ScanInfo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">insert1</span><span class="p">(</span>
            <span class="nb">dict</span><span class="p">(</span>
                <span class="n">key</span><span class="p">,</span>
                <span class="n">nfields</span><span class="o">=</span><span class="n">nd2_file</span><span class="o">.</span><span class="n">sizes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;P&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                <span class="n">nchannels</span><span class="o">=</span><span class="n">nd2_file</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">channelCount</span><span class="p">,</span>
                <span class="n">nframes</span><span class="o">=</span><span class="n">nd2_file</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">contents</span><span class="o">.</span><span class="n">frameCount</span><span class="p">,</span>
                <span class="n">ndepths</span><span class="o">=</span><span class="n">nd2_file</span><span class="o">.</span><span class="n">sizes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Z&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">z</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">fps</span><span class="o">=</span><span class="n">fps</span><span class="p">,</span>
                <span class="n">bidirectional</span><span class="o">=</span><span class="nb">bool</span><span class="p">(</span>
                    <span class="n">nd2_file</span><span class="o">.</span><span class="n">custom_data</span><span class="p">[</span><span class="s2">&quot;GrabberCameraSettingsV1_0&quot;</span><span class="p">][</span>
                        <span class="s2">&quot;GrabberCameraSettings&quot;</span>
                    <span class="p">][</span><span class="s2">&quot;PropertiesQuality&quot;</span><span class="p">][</span><span class="s2">&quot;ScanDirection&quot;</span><span class="p">]</span>
                <span class="p">),</span>
                <span class="n">nrois</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">scan_datetime</span><span class="o">=</span><span class="n">scan_datetime</span><span class="p">,</span>
                <span class="n">scan_duration</span><span class="o">=</span><span class="n">scan_duration</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># MultiROI to be implemented later</span>

        <span class="c1"># Insert in Field</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_multiROI</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Field</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="nb">dict</span><span class="p">(</span>
                        <span class="n">key</span><span class="p">,</span>
                        <span class="n">field_idx</span><span class="o">=</span><span class="n">plane_idx</span><span class="p">,</span>
                        <span class="n">px_height</span><span class="o">=</span><span class="n">nd2_file</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">heightPx</span><span class="p">,</span>
                        <span class="n">px_width</span><span class="o">=</span><span class="n">nd2_file</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">widthPx</span><span class="p">,</span>
                        <span class="n">um_height</span><span class="o">=</span><span class="n">nd2_file</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">heightPx</span>
                        <span class="o">*</span> <span class="n">nd2_file</span><span class="o">.</span><span class="n">voxel_size</span><span class="p">()</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
                        <span class="n">um_width</span><span class="o">=</span><span class="n">nd2_file</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">widthPx</span>
                        <span class="o">*</span> <span class="n">nd2_file</span><span class="o">.</span><span class="n">voxel_size</span><span class="p">()</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
                        <span class="n">field_x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">field_y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">field_z</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="k">for</span> <span class="n">plane_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nd2_file</span><span class="o">.</span><span class="n">sizes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Z&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
                <span class="p">]</span>
            <span class="p">)</span>
    <span class="k">elif</span> <span class="n">acq_software</span> <span class="o">==</span> <span class="s2">&quot;PrairieView&quot;</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">element_interface</span> <span class="kn">import</span> <span class="n">prairieviewreader</span>

        <span class="n">scan_filepaths</span> <span class="o">=</span> <span class="n">get_image_files</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s2">&quot;*.tif&quot;</span><span class="p">)</span>
        <span class="n">PVScan_info</span> <span class="o">=</span> <span class="n">prairieviewreader</span><span class="o">.</span><span class="n">get_pv_metadata</span><span class="p">(</span><span class="n">scan_filepaths</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">insert1</span><span class="p">(</span>
            <span class="nb">dict</span><span class="p">(</span>
                <span class="n">key</span><span class="p">,</span>
                <span class="n">nfields</span><span class="o">=</span><span class="n">PVScan_info</span><span class="p">[</span><span class="s2">&quot;num_fields&quot;</span><span class="p">],</span>
                <span class="n">nchannels</span><span class="o">=</span><span class="n">PVScan_info</span><span class="p">[</span><span class="s2">&quot;num_channels&quot;</span><span class="p">],</span>
                <span class="n">ndepths</span><span class="o">=</span><span class="n">PVScan_info</span><span class="p">[</span><span class="s2">&quot;num_planes&quot;</span><span class="p">],</span>
                <span class="n">nframes</span><span class="o">=</span><span class="n">PVScan_info</span><span class="p">[</span><span class="s2">&quot;num_frames&quot;</span><span class="p">],</span>
                <span class="n">nrois</span><span class="o">=</span><span class="n">PVScan_info</span><span class="p">[</span><span class="s2">&quot;num_rois&quot;</span><span class="p">],</span>
                <span class="n">x</span><span class="o">=</span><span class="n">PVScan_info</span><span class="p">[</span><span class="s2">&quot;x_pos&quot;</span><span class="p">],</span>
                <span class="n">y</span><span class="o">=</span><span class="n">PVScan_info</span><span class="p">[</span><span class="s2">&quot;y_pos&quot;</span><span class="p">],</span>
                <span class="n">z</span><span class="o">=</span><span class="n">PVScan_info</span><span class="p">[</span><span class="s2">&quot;z_pos&quot;</span><span class="p">],</span>
                <span class="n">fps</span><span class="o">=</span><span class="n">PVScan_info</span><span class="p">[</span><span class="s2">&quot;frame_rate&quot;</span><span class="p">],</span>
                <span class="n">bidirectional</span><span class="o">=</span><span class="n">PVScan_info</span><span class="p">[</span><span class="s2">&quot;bidirectional&quot;</span><span class="p">],</span>
                <span class="n">bidirectional_z</span><span class="o">=</span><span class="n">PVScan_info</span><span class="p">[</span><span class="s2">&quot;bidirectional_z&quot;</span><span class="p">],</span>
                <span class="n">usecs_per_line</span><span class="o">=</span><span class="n">PVScan_info</span><span class="p">[</span><span class="s2">&quot;usecs_per_line&quot;</span><span class="p">],</span>
                <span class="n">scan_datetime</span><span class="o">=</span><span class="n">PVScan_info</span><span class="p">[</span><span class="s2">&quot;scan_datetime&quot;</span><span class="p">],</span>
                <span class="n">scan_duration</span><span class="o">=</span><span class="n">PVScan_info</span><span class="p">[</span><span class="s2">&quot;scan_duration&quot;</span><span class="p">],</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Field</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span>
            <span class="nb">dict</span><span class="p">(</span>
                <span class="n">key</span><span class="p">,</span>
                <span class="n">field_idx</span><span class="o">=</span><span class="n">plane_idx</span><span class="p">,</span>
                <span class="n">px_height</span><span class="o">=</span><span class="n">PVScan_info</span><span class="p">[</span><span class="s2">&quot;height_in_pixels&quot;</span><span class="p">],</span>
                <span class="n">px_width</span><span class="o">=</span><span class="n">PVScan_info</span><span class="p">[</span><span class="s2">&quot;width_in_pixels&quot;</span><span class="p">],</span>
                <span class="n">um_height</span><span class="o">=</span><span class="n">PVScan_info</span><span class="p">[</span><span class="s2">&quot;height_in_um&quot;</span><span class="p">],</span>
                <span class="n">um_width</span><span class="o">=</span><span class="n">PVScan_info</span><span class="p">[</span><span class="s2">&quot;width_in_um&quot;</span><span class="p">],</span>
                <span class="n">field_x</span><span class="o">=</span><span class="n">PVScan_info</span><span class="p">[</span><span class="s2">&quot;fieldX&quot;</span><span class="p">],</span>
                <span class="n">field_y</span><span class="o">=</span><span class="n">PVScan_info</span><span class="p">[</span><span class="s2">&quot;fieldY&quot;</span><span class="p">],</span>
                <span class="n">field_z</span><span class="o">=</span><span class="n">PVScan_info</span><span class="p">[</span><span class="s2">&quot;fieldZ&quot;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">PVScan_info</span><span class="p">[</span><span class="s2">&quot;num_planes&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span>
                <span class="k">else</span> <span class="n">PVScan_info</span><span class="p">[</span><span class="s2">&quot;fieldZ&quot;</span><span class="p">][</span><span class="n">plane_idx</span><span class="p">],</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">plane_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">PVScan_info</span><span class="p">[</span><span class="s2">&quot;num_planes&quot;</span><span class="p">])</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Loading routine not implemented for </span><span class="si">{</span><span class="n">acq_software</span><span class="si">}</span><span class="s2"> &quot;</span>
            <span class="s2">&quot;acquisition software&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Insert file(s)</span>
    <span class="n">root_dir</span> <span class="o">=</span> <span class="n">find_root_directory</span><span class="p">(</span><span class="n">get_imaging_root_data_dir</span><span class="p">(),</span> <span class="n">scan_filepaths</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="n">scan_files</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">.</span><span class="n">relative_to</span><span class="p">(</span><span class="n">root_dir</span><span class="p">)</span><span class="o">.</span><span class="n">as_posix</span><span class="p">()</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">scan_filepaths</span>
    <span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ScanFile</span><span class="o">.</span><span class="n">insert</span><span class="p">([{</span><span class="o">**</span><span class="n">key</span><span class="p">,</span> <span class="s2">&quot;file_path&quot;</span><span class="p">:</span> <span class="n">f</span><span class="p">}</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">scan_files</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>




  </div>

  </div>

</div>






<div class="doc doc-object doc-class">



<h2 id="element_calcium_imaging.scan.ScanQualityMetrics" class="doc doc-heading">
        <code>ScanQualityMetrics</code>


<a href="#element_calcium_imaging.scan.ScanQualityMetrics" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="datajoint">dj</span>.<span title="datajoint.Computed">Computed</span></code></p>

  
      <p>Metrics to assess the quality of the scan.</p>

  <p><strong>Attributes:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>ScanInfo.Field</code></td>
          <td>
                <code>foreign key</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Primary key from ScanInfo.Field.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>


        <details class="quote">
          <summary>Source code in <code>element_calcium_imaging/scan.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@schema</span>
<span class="k">class</span> <span class="nc">ScanQualityMetrics</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">Computed</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Metrics to assess the quality of the scan.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        ScanInfo.Field (foreign key): Primary key from ScanInfo.Field.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    -&gt; ScanInfo.Field</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="k">class</span> <span class="nc">Frames</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">Part</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Metrics used to evaluate each frame.</span>

<span class="sd">        Attributes:</span>
<span class="sd">            ScanInfo.Field (foreign key): Primary key from ScanInfo.Field.</span>
<span class="sd">            Channel (foreign key): Primary key from Channel.</span>
<span class="sd">            min_intensity (longblob): Minimum value of each frame.</span>
<span class="sd">            mean_intensity (longblob): Mean value of each frame.</span>
<span class="sd">            max_intensity (longblob): Maximum value of each frame.</span>
<span class="sd">            contrast (longblob): Contrast of each frame (i.e. difference between the 99 and 1 percentiles)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        -&gt; master</span>
<span class="s2">        -&gt; Channel</span>
<span class="s2">        ---</span>
<span class="s2">        min_intensity: longblob   # Minimum value of each frame.</span>
<span class="s2">        mean_intensity: longblob  # Mean value of each frame.</span>
<span class="s2">        max_intensity: longblob   # Maximum value of each frame.</span>
<span class="s2">        contrast: longblob        # Contrast of each frame (i.e. difference between the 99 and 1 percentiles)</span>
<span class="s2">        &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">make</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="n">acq_software</span><span class="p">,</span> <span class="n">nchannels</span> <span class="o">=</span> <span class="p">(</span><span class="n">Scan</span> <span class="o">*</span> <span class="n">ScanInfo</span> <span class="o">&amp;</span> <span class="n">key</span><span class="p">)</span><span class="o">.</span><span class="n">fetch1</span><span class="p">(</span>
            <span class="s2">&quot;acq_software&quot;</span><span class="p">,</span> <span class="s2">&quot;nchannels&quot;</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">acq_software</span> <span class="o">==</span> <span class="s2">&quot;ScanImage&quot;</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">scanreader</span>

            <span class="c1"># Switch from FYXCT to TCYX</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">scanreader</span><span class="o">.</span><span class="n">read_scan</span><span class="p">(</span><span class="n">get_image_files</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s2">&quot;*.tif&quot;</span><span class="p">))[</span>
                <span class="n">key</span><span class="p">[</span><span class="s2">&quot;field_idx&quot;</span><span class="p">]</span>
            <span class="p">]</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">acq_software</span> <span class="o">==</span> <span class="s2">&quot;Scanbox&quot;</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">sbxreader</span> <span class="kn">import</span> <span class="n">sbx_memmap</span>

            <span class="c1"># Switch from TFCYX to TCYX</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">sbx_memmap</span><span class="p">(</span><span class="n">get_image_files</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s2">&quot;*.sbx&quot;</span><span class="p">))[:,</span> <span class="n">key</span><span class="p">[</span><span class="s2">&quot;field_idx&quot;</span><span class="p">]]</span>
        <span class="k">elif</span> <span class="n">acq_software</span> <span class="o">==</span> <span class="s2">&quot;NIS&quot;</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">nd2</span>

            <span class="n">nd2_file</span> <span class="o">=</span> <span class="n">nd2</span><span class="o">.</span><span class="n">ND2File</span><span class="p">(</span><span class="n">get_image_files</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="s2">&quot;*.nd2&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>

            <span class="n">nd2_dims</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">nd2_file</span><span class="o">.</span><span class="n">sizes</span><span class="p">)}</span>

            <span class="n">valid_dimensions</span> <span class="o">=</span> <span class="s2">&quot;TZCYX&quot;</span>
            <span class="k">assert</span> <span class="nb">set</span><span class="p">(</span><span class="n">nd2_dims</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="nb">set</span><span class="p">(</span>
                <span class="n">valid_dimensions</span>
            <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Unknown dimensions </span><span class="si">{</span><span class="nb">set</span><span class="p">(</span><span class="n">nd2_dims</span><span class="p">)</span><span class="o">-</span><span class="nb">set</span><span class="p">(</span><span class="n">valid_dimensions</span><span class="p">)</span><span class="si">}</span><span class="s2"> in file </span><span class="si">{</span><span class="n">get_image_files</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;*.nd2&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">.&quot;</span>

            <span class="c1"># Sort the dimensions in the order of TZCYX, skipping the missing ones.</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">nd2_file</span><span class="o">.</span><span class="n">asarray</span><span class="p">()</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span>
                <span class="p">[</span><span class="n">nd2_dims</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">valid_dimensions</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">nd2_dims</span><span class="p">]</span>
            <span class="p">)</span>

            <span class="c1"># Expand array to include the missing dimensions.</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">dim</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="s2">&quot;TZC&quot;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">dim</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">nd2_dims</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>

            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span> <span class="n">key</span><span class="p">[</span><span class="s2">&quot;field_idx&quot;</span><span class="p">]]</span>  <span class="c1"># Switch from TFCYX to TCYX</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">insert1</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nchannels</span><span class="p">):</span>
            <span class="n">movie</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span> <span class="n">channel</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">Frames</span><span class="o">.</span><span class="n">insert1</span><span class="p">(</span>
                <span class="nb">dict</span><span class="p">(</span>
                    <span class="n">key</span><span class="p">,</span>
                    <span class="n">channel</span><span class="o">=</span><span class="n">channel</span><span class="p">,</span>
                    <span class="n">min_intensity</span><span class="o">=</span><span class="n">movie</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span>
                    <span class="n">mean_intensity</span><span class="o">=</span><span class="n">movie</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span>
                    <span class="n">max_intensity</span><span class="o">=</span><span class="n">movie</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span>
                    <span class="n">contrast</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">movie</span><span class="p">,</span> <span class="mi">99</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
                    <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">movie</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span>
                <span class="p">)</span>
            <span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">







<div class="doc doc-object doc-class">



<h3 id="element_calcium_imaging.scan.ScanQualityMetrics.Frames" class="doc doc-heading">
        <code>Frames</code>


<a href="#element_calcium_imaging.scan.ScanQualityMetrics.Frames" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="datajoint">dj</span>.<span title="datajoint.Part">Part</span></code></p>

  
      <p>Metrics used to evaluate each frame.</p>

  <p><strong>Attributes:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>ScanInfo.Field</code></td>
          <td>
                <code>foreign key</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Primary key from ScanInfo.Field.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>Channel</code></td>
          <td>
                <code>foreign key</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Primary key from Channel.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>min_intensity</code></td>
          <td>
                <code>longblob</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Minimum value of each frame.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>mean_intensity</code></td>
          <td>
                <code>longblob</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Mean value of each frame.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>max_intensity</code></td>
          <td>
                <code>longblob</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Maximum value of each frame.</p>
            </div>
          </td>
        </tr>
        <tr>
          <td><code>contrast</code></td>
          <td>
                <code>longblob</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Contrast of each frame (i.e. difference between the 99 and 1 percentiles)</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>


        <details class="quote">
          <summary>Source code in <code>element_calcium_imaging/scan.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Frames</span><span class="p">(</span><span class="n">dj</span><span class="o">.</span><span class="n">Part</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Metrics used to evaluate each frame.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        ScanInfo.Field (foreign key): Primary key from ScanInfo.Field.</span>
<span class="sd">        Channel (foreign key): Primary key from Channel.</span>
<span class="sd">        min_intensity (longblob): Minimum value of each frame.</span>
<span class="sd">        mean_intensity (longblob): Mean value of each frame.</span>
<span class="sd">        max_intensity (longblob): Maximum value of each frame.</span>
<span class="sd">        contrast (longblob): Contrast of each frame (i.e. difference between the 99 and 1 percentiles)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">definition</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    -&gt; master</span>
<span class="s2">    -&gt; Channel</span>
<span class="s2">    ---</span>
<span class="s2">    min_intensity: longblob   # Minimum value of each frame.</span>
<span class="s2">    mean_intensity: longblob  # Mean value of each frame.</span>
<span class="s2">    max_intensity: longblob   # Maximum value of each frame.</span>
<span class="s2">    contrast: longblob        # Contrast of each frame (i.e. difference between the 99 and 1 percentiles)</span>
<span class="s2">    &quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">





  </div>

  </div>

</div>




  </div>

  </div>

</div>




  </div>

  </div>

</div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
</div>
      
        <div class="md-social">
  
    
    
    
    
    <a href="https://www.datajoint.com" target="_blank" rel="noopener" title="DataJoint" class="md-social__link">
      <?xml version="1.0" encoding="utf-8"?>
<!-- Generator: Adobe Illustrator 15.1.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 width="260.479px" height="365.463px" viewBox="0 0 260.479 365.463" enable-background="new 0 0 260.479 365.463"
	 xml:space="preserve">
<g>
	<path d="M4.638,361.434c0,0,124.071-124.072,135.896-357.434c0,0,29.555,189.053,115.266,256.988
		C255.799,260.988,173.038,249.174,4.638,361.434z"/>
</g>
</svg>
    </a>
  
    
    
    
    
    <a href="https://datajoint.slack.com" target="_blank" rel="noopener" title="Slack" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M94.12 315.1c0 25.9-21.16 47.06-47.06 47.06S0 341 0 315.1c0-25.9 21.16-47.06 47.06-47.06h47.06v47.06zm23.72 0c0-25.9 21.16-47.06 47.06-47.06s47.06 21.16 47.06 47.06v117.84c0 25.9-21.16 47.06-47.06 47.06s-47.06-21.16-47.06-47.06V315.1zm47.06-188.98c-25.9 0-47.06-21.16-47.06-47.06S139 32 164.9 32s47.06 21.16 47.06 47.06v47.06H164.9zm0 23.72c25.9 0 47.06 21.16 47.06 47.06s-21.16 47.06-47.06 47.06H47.06C21.16 243.96 0 222.8 0 196.9s21.16-47.06 47.06-47.06H164.9zm188.98 47.06c0-25.9 21.16-47.06 47.06-47.06 25.9 0 47.06 21.16 47.06 47.06s-21.16 47.06-47.06 47.06h-47.06V196.9zm-23.72 0c0 25.9-21.16 47.06-47.06 47.06-25.9 0-47.06-21.16-47.06-47.06V79.06c0-25.9 21.16-47.06 47.06-47.06 25.9 0 47.06 21.16 47.06 47.06V196.9zM283.1 385.88c25.9 0 47.06 21.16 47.06 47.06 0 25.9-21.16 47.06-47.06 47.06-25.9 0-47.06-21.16-47.06-47.06v-47.06h47.06zm0-23.72c-25.9 0-47.06-21.16-47.06-47.06 0-25.9 21.16-47.06 47.06-47.06h117.84c25.9 0 47.06 21.16 47.06 47.06 0 25.9-21.16 47.06-47.06 47.06H283.1z"/></svg>
    </a>
  
    
    
    
    
    <a href="https://www.linkedin.com/company/datajoint" target="_blank" rel="noopener" title="LinkedIn" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
    </a>
  
    
    
    
    
    <a href="https://twitter.com/datajoint" target="_blank" rel="noopener" title="Twitter" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
    </a>
  
    
    
    
    
    <a href="https://github.com/datajoint" target="_blank" rel="noopener" title="GitHub" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
    
    
    
    
    <a href="https://hub.docker.com/u/datajoint" target="_blank" rel="noopener" title="DockerHub" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M349.9 236.3h-66.1v-59.4h66.1v59.4zm0-204.3h-66.1v60.7h66.1V32zm78.2 144.8H362v59.4h66.1v-59.4zm-156.3-72.1h-66.1v60.1h66.1v-60.1zm78.1 0h-66.1v60.1h66.1v-60.1zm276.8 100c-14.4-9.7-47.6-13.2-73.1-8.4-3.3-24-16.7-44.9-41.1-63.7l-14-9.3-9.3 14c-18.4 27.8-23.4 73.6-3.7 103.8-8.7 4.7-25.8 11.1-48.4 10.7H2.4c-8.7 50.8 5.8 116.8 44 162.1 37.1 43.9 92.7 66.2 165.4 66.2 157.4 0 273.9-72.5 328.4-204.2 21.4.4 67.6.1 91.3-45.2 1.5-2.5 6.6-13.2 8.5-17.1l-13.3-8.9zm-511.1-27.9h-66v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1v-59.4zm-78.1-72.1h-66.1v60.1h66.1v-60.1z"/></svg>
    </a>
  
    
    
    
    
    <a href="https://pypi.org/user/datajointbot" target="_blank" rel="noopener" title="PyPI" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.8 200.5c-7.7-30.9-22.3-54.2-53.4-54.2h-40.1v47.4c0 36.8-31.2 67.8-66.8 67.8H172.7c-29.2 0-53.4 25-53.4 54.3v101.8c0 29 25.2 46 53.4 54.3 33.8 9.9 66.3 11.7 106.8 0 26.9-7.8 53.4-23.5 53.4-54.3v-40.7H226.2v-13.6h160.2c31.1 0 42.6-21.7 53.4-54.2 11.2-33.5 10.7-65.7 0-108.6zM286.2 404c11.1 0 20.1 9.1 20.1 20.3 0 11.3-9 20.4-20.1 20.4-11 0-20.1-9.2-20.1-20.4.1-11.3 9.1-20.3 20.1-20.3zM167.8 248.1h106.8c29.7 0 53.4-24.5 53.4-54.3V91.9c0-29-24.4-50.7-53.4-55.6-35.8-5.9-74.7-5.6-106.8.1-45.2 8-53.4 24.7-53.4 55.6v40.7h106.9v13.6h-147c-31.1 0-58.3 18.7-66.8 54.2-9.8 40.7-10.2 66.1 0 108.6 7.6 31.6 25.7 54.2 56.8 54.2H101v-48.8c0-35.3 30.5-66.4 66.8-66.4zm-6.7-142.6c-11.1 0-20.1-9.1-20.1-20.3.1-11.3 9-20.4 20.1-20.4 11 0 20.1 9.2 20.1 20.4s-9 20.3-20.1 20.3z"/></svg>
    </a>
  
    
    
    
    
    <a href="https://stackoverflow.com/questions/tagged/datajoint" target="_blank" rel="noopener" title="StackOverflow" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M290.7 311 95 269.7 86.8 309l195.7 41zm51-87L188.2 95.7l-25.5 30.8 153.5 128.3zm-31.2 39.7L129.2 179l-16.7 36.5L293.7 300zM262 32l-32 24 119.3 160.3 32-24zm20.5 328h-200v39.7h200zm39.7 80H42.7V320h-40v160h359.5V320h-40z"/></svg>
    </a>
  
    
    
    
    
    <a href="https://www.youtube.com/channel/UCdeCuFOTCXlVMRzh6Wk-lGg" target="_blank" rel="noopener" title="YouTube" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["toc.integrate", "content.code.annotate"], "search": "../../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.b4d07000.min.js"></script>
      
        <script src="https://js-na1.hs-scripts.com/23133402.js"></script>
      
        <script src="../../../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>